!function(){"use strict";angular.module("myApp",["ngTouch","ui.bootstrap"]).factory("gameLogic",function(){function a(a){var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function b(a){var b=[];for(var c in t)angular.isUndefined(a)?b.push(t[c]):g(a,t[c])&&b.push(t[c]);return b}function c(a){switch(a){case"2":return 1;case"3":return 2;case"4":return 3;case"5":return 4;case"6":return 5;case"7":return 6;case"8":return 7;case"9":return 8;case"10":return 9;case"J":return 10;case"Q":return 11;case"K":return 12;case"A":return 13;default:throw new Error("Illegal rank!")}}function d(a,b){if(!a){console.log(b);for(var c=2;c<arguments.length;c++)console.log(arguments[c]);throw new Error("Fails!")}}function e(a){d(a>=0&&52>a,"Illegal index");var b,c;switch(13>a?b=s.CLUBS:26>a?b=s.DIAMONDS:39>a?b=s.HEARTS:52>a&&(b=s.SPADES),a%13){case 0:c=t.TWO;break;case 1:c=t.THREE;break;case 2:c=t.FOUR;break;case 3:c=t.FIVE;break;case 4:c=t.SIX;break;case 5:c=t.SEVEN;break;case 6:c=t.EIGHT;break;case 7:c=t.NINE;break;case 8:c=t.TEN;break;case 9:c=t.JACK;break;case 10:c=t.QUEEN;break;case 11:c=t.KING;break;case 12:c=t.ACE}return b+c}function f(a){var b=a.substring(0,1),d=a.substring(1),e=c(d)-1;return b===s.DIAMONDS&&(e+=13),b===s.HEARTS&&(e+=26),b===s.SPADES&&(e+=39),e}function g(a,b){var d=Math.abs(c(a)-c(b));return 1>=d||12===d}function h(a){for(var b,c=a.length,d=0;c--;)d=Math.floor(Math.random()*(c+1)),b=a[c],a[c]=a[d],a[d]=b;return a}function i(a,c){var d=[];switch(a.stage){case r.DO_CLAIM:var e=Math.floor(a.black.length>=4?4*Math.random()+1:Math.random()*a.black.length+1),f=b(a.claim[1]),g=[e,f[Math.floor(Math.random()*f.length)]],i=a.black.clone();h(i);var k=i.slice(0,e);d=o(a,c,g,k);break;case r.DECLARE_CHEATER:var m=Math.random()>.5;-1!==j(a)&&(m=!0),d=l(a,c,m);break;case r.CHECK_CLAIM:d=n(a,c)}return d}function j(a){return 0===a.white.length?0:0===a.black.length?1:-1}function k(){var a,b=[],c=[],d=[],f=[],g=[],h=[];for(a=0;26>a;a++)c[a]=a;for(a=26;52>a;a++)d[a-26]=a;for(a=0;52>a;a++)f[a]={set:{key:"card"+a,value:e(a)}},g[a]=26>a?{setVisibility:{key:"card"+a,visibleToPlayerIndexes:[0]}}:{setVisibility:{key:"card"+a,visibleToPlayerIndexes:[1]}},h[a]="card"+a;return b.selfConcat([{setTurn:{turnIndex:0}}]),b.selfConcat([{set:{key:"white",value:c}}]),b.selfConcat([{set:{key:"black",value:d}}]),b.selfConcat([{set:{key:"middle",value:[]}}]),b.selfConcat([{set:{key:"stage",value:r.DO_CLAIM}}]),b.selfConcat(f),b.selfConcat([{shuffle:{keys:h}}]),b.selfConcat(g),b}function l(a,b,c){var d=[];if(c){d.selfConcat([{setTurn:{turnIndex:b}}]),d.selfConcat([{set:{key:"stage",value:r.CHECK_CLAIM}}]);for(var e=[],f=0;f<a.middle.length;f++)e.selfConcat([{setVisibility:{key:"card"+a.middle[f],visibleToPlayerIndexes:[b]}}]);d.selfConcat(e)}else d.selfConcat([{setTurn:{turnIndex:b}}]),d.selfConcat(-1===j(a)?[{set:{key:"stage",value:r.DO_CLAIM}}]:[{set:{key:"stage",value:r.END}}]);return d}function m(a){for(var b=a.claim,c=a.middle,d=c.length-1;d>=c.length-b[0];d--)if(a["card"+c[d]].substring(1)!==b[1])return!0;return!1}function n(a,b){var c,d=m(a)?1-b:b,e=[],f=[],g=[];e=0===d?a.white:a.black,c=e.concat(a.middle),f.selfConcat([{setTurn:{turnIndex:b}}]),f.selfConcat(0===d?[{set:{key:"white",value:c}}]:[{set:{key:"black",value:c}}]),f.selfConcat([{set:{key:"middle",value:[]}}]),f.selfConcat([{set:{key:"stage",value:r.DO_CLAIM}}]);for(var h=0;h<a.middle.length;h++)g.selfConcat(0===d?[{setVisibility:{key:"card"+a.middle[h],visibleToPlayerIndexes:[0]}}]:[{setVisibility:{key:"card"+a.middle[h],visibleToPlayerIndexes:[1]}}]);return f.selfConcat(g),f.selfConcat([{set:{key:"claim",value:[]}}]),f}function o(a,b,c,e){d(e.length>=1&&e.length<=4),d(e.length===c[0]);var f,h,i,j,k=a.claim;angular.isUndefined(k)||angular.isUndefined(k[0])||d(g(k[1],c[1])),f=0===b?a.white:a.black,h=f.clone(),h.selfSubtract(e),i=a.middle,j=i.concat(e);var l=[];l.selfConcat([{setTurn:{turnIndex:1-b}}]),0===b?(l.selfConcat([{set:{key:"white",value:h}}]),l.selfConcat([{set:{key:"middle",value:j}}])):(l.selfConcat([{set:{key:"black",value:h}}]),l.selfConcat([{set:{key:"middle",value:j}}]));for(var m=[],n=0;n<e.length;n++)m.selfConcat([{setVisibility:{key:"card"+e[n],visibleToPlayerIndexes:[]}}]);return l.selfConcat([{set:{key:"claim",value:c}}]),l.selfConcat([{set:{key:"stage",value:r.DECLARE_CHEATER}}]),l.selfConcat(m),l}function p(a){var b=[],c=j(a);return 0===c?b.selfConcat([{endMatch:{endMatchScores:[1,0]}}]):1===c&&b.selfConcat([{endMatch:{endMatchScores:[0,1]}}]),b.selfConcat([{set:{key:"middle",value:[]}}]),b.selfConcat([{set:{key:"stage",value:r.END}}]),b}function q(a){var b,c=a.stateBeforeMove,d=a.turnIndexBeforeMove,e=a.move;try{switch(a.stateBeforeMove.stage){case r.DO_CLAIM:var f=e[3].set.value,g=c.middle,h=e[2].set.value,i=h.clone();i.selfSubtract(g),b=o(c,d,f,i);break;case r.DECLARE_CHEATER:var j=e[1].set.value===r.CHECK_CLAIM;b=l(c,d,j);break;case r.CHECK_CLAIM:b=n(c,d);break;case r.END:b=p(c);break;default:if(0!=d||angular.isUndefined(c))throw new Error("Illegal initial move!");b=k()}}catch(m){return!1}return angular.equals(e,b)?!0:!1}var r={SET_UP:"SET_UP",DO_CLAIM:"DO_CLAIM",DECLARE_CHEATER:"DECLARE_CHEATER",CHECK_CLAIM:"CHECK_CLAIM",END:"END"},s={DIAMONDS:"D",HEARTS:"H",SPADES:"S",CLUBS:"C"},t={TWO:"2",THREE:"3",FOUR:"4",FIVE:"5",SIX:"6",SEVEN:"7",EIGHT:"8",NINE:"9",TEN:"10",JACK:"J",QUEEN:"Q",KING:"K",ACE:"A"};return Array.prototype.selfConcat=function(a){d(a.constructor===Array);for(var b=0;b<a.length;b++)this.push(a[b])},Array.prototype.selfSubtract=function(a){var b=this.length;this.removeAll(a),d(b===this.length+a.length,"The elements are not proper removed...",this,a)},Array.prototype.containsAll=function(a){d(a.constructor===Array,"The argument is not an array!");for(var b=0;b<a.length;b++)if(-1==this.indexOf(a[b]))return!1;return!0},Array.prototype.removeAll=function(a){d(a.constructor===Array,"The argument is not an array!"),d(this.containsAll(a),"The array does not contain all the elements.",this,a);for(var b=0;b<a.length;b++){var c=this.indexOf(a[b]);this.splice(c,1)}},Array.prototype.clone=function(){return this.slice(0)},{isMoveOk:q,isEmptyObj:a,didCheat:m,createComputerMove:i,getInitialMove:k,getClaimMove:o,getDeclareCheaterMove:l,getMoveCheckIfCheated:n,getWinMove:p,getRankScore:c,getCard:e,getWinner:j,getRankArray:b,getCardReverse:f,STAGE:r}})}(),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","gameService","gameLogic","resizeGameAreaService","$translate",function(a,b,c,d,e,f,g){"use strict";function h(b){if(a.state=b.stateAfterMove,e.isEmptyObj(a.state))return void(0===b.yourPlayerIndex&&(d.makeMove(e.getInitialMove()),R=1));console.log(b.stateAfterMove),a.currIndex=b.turnIndexAfterMove,Z=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.playMode=b.playMode,a.middle=a.state.middle.clone(),aa=b.turnIndexAfterMove,j(),0===a.currIndex?(a.playerOneCards=a.state.white.clone(),a.playerTwoCards=a.state.black.clone()):1===a.currIndex?(a.playerOneCards=a.state.black.clone(),a.playerTwoCards=a.state.white.clone()):0===b.yourPlayerIndex?(a.playerOneCards=a.state.white.clone(),a.playerTwoCards=a.state.black.clone()):(a.playerOneCards=a.state.black.clone(),a.playerTwoCards=a.state.white.clone()),a.middle=a.state.middle.clone(),t(),ea=[];for(var c=0;c<a.playerOneCards.length;c++){var f="card"+a.playerOneCards[c],h=e.getCardReverse(a.state[f]);ea.push(h)}if(s(),0!==R){o(a.currIndex),F(35),G(35),H();var i=Z&&""===b.playersInfo[b.yourPlayerIndex].playerId;if("playAgainstTheComputer"===b.playMode&&0!=a.currIndex&&(Z=!1),console.log("is your turn is: "+Z),Z)switch(a.state.stage){case ha.DO_CLAIM:console.log("Do Claim"),E(20),k(),A(),n(),z();break;case ha.DECLARE_CHEATER:l(),console.log("declare cheater");break;case ha.CHECK_CLAIM:console.log("check claim"),a.ifCheat=!0,a.resultMessage=g("PLAYER")+a.currIndex+": ",a.resultMessage+=g(e.didCheat(a.state)?"SUC":"FAIL"),p()}i&&(Z=!1,a.state.stage===ha.CHECK_CLAIM&&(a.ifCheat=!0,a.resultMessage=g("PLAYER")+a.currIndex+": ",a.resultMessage+=g(e.didCheat(a.state)?"SUC":"FAIL")),r())}}function i(a){return Z?void d.makeMove(a):void b.info("User cannot make a move now! move=",a)}function j(){aa=null,ba=0,ca=[],da={},ea=[],ia=[],fa=1,ga=[],_.removeAllChildren(),H()}function k(){J(g("CANCEL"),400,V-100,L),J(g("MKCLAIM"),200,V-100,x),v(g("MKCLAIM")),w(),v("ops"),u(g("CANCEL")),H()}function l(){m()}function m(){var b=new createjs.Container,c=new createjs.Shape;c.graphics.beginFill("#006400").drawRect(0,600,600,800);var d=a.state.claim[0]+g("M1")+a.state.claim[1]+g("M2"),e=new createjs.Text(d,"bold 40px 'Shadows Into Light'","#FFFFFF");e.textAlign="center",e.textBaseline="middle",e.x=300,e.y=650,b.addChild(c,e),_.addChild(b),J(g("BULLSHIT"),100,800,function(){a.declare(!0)}),J(g("PASS"),350,800,function(){a.declare(!1)}),H()}function n(){if(angular.isUndefined(a.state.claim))a.claimRanks=e.getRankArray();else{var b=a.state.claim[1];a.claimRanks=e.getRankArray(b)}}function o(b){var c=g("PTI")+" "+b,d=new createjs.Text(c,"bold 35px 'Shadows Into Light'","#FFFFFF");d.x=20,d.y=20;var e=void 0===a.state.claim||void 0===a.state.claim[1]?"":a.state.claim[1],f=g("LAST")+" "+e,h=new createjs.Text(f,"bold 35px 'Shadows Into Light'","#FFFFFF");h.x=300,h.y=20,_.addChild(d,h)}function p(){var b=e.getMoveCheckIfCheated(a.state,a.currIndex);d.makeMove(b)}function q(){return-1!==e.getWinner(a.state)}function r(){var b=e.createComputerMove(a.state,a.currIndex);1===a.currIndex&&d.makeMove(b)}function s(){if(console.log(q()+"&&&&&&&&"+a.state.stage),q()&&a.state.stage===ha.DO_CLAIM){console.log("game is end!"),j(),R=0;var b=e.getWinMove(a.state);d.makeMove(b)}}function t(){var b=function(b,c){if(null!==a.state["card"+b]){var d=a.state["card"+b].substring(1),f=a.state["card"+c].substring(1),g=e.getRankScore(d),h=e.getRankScore(f);return g-h}return 1};a.playerOneCards.sort(b),a.playerTwoCards.sort(b)}function u(a){da[a].visible=!0,H()}function v(a){da[a].visible=!1,H()}function w(){var a=new createjs.Shape;a.graphics.beginFill("#006400").drawRect(0,0,800,800),a.x=0,a.y=660,_.addChild(a),da.ops=a}function x(){fa=0,v(g("MKCLAIM")),u("ops"),console.log(ga),y(),H()}function y(){for(var a=0;a<ga.length;a++)u(ga[a])}function z(){S=new createjs.Shape,S.graphics.beginFill("orange").drawCircle(0,0,10),S.visible=!1,S.on("pressmove",function(a){this.y=a.stageY,this.x=a.stageX,_.update()}),_.on("pressup",function(){S.visible=!1;for(var a=0;a<ca.length;a++).2===ca[a].alpha&&P(ca[a]);H()}),_.addChild(S)}function A(){var b=void 0===a.state.claim?void 0:a.state.claim[1];ga=e.getRankArray(b);for(var c=80,d=V,f=0;f<ga.length;f++){var g=ga[f];I(g,c,d,B),c+=100,(4==f||9==f)&&(c=80,d+=100)}D()}function B(){T=this,console.log(T),C()?(a.sureToClaim=!0,a.$apply()):a.makeACheat()}function C(){for(var a=0;a<ia.length;a++){var b=e.getCard(ia[a]);if((3!==b.length||"10"!==T)&&b[1]!==T)return!0}return!1}function D(){for(var a=0;a<ga.length;a++)v(ga[a])}function E(a){var b=ea.length,c=10,d=480;U=(d-c)/(b>a?a:b);for(var e=c-U,f=V,g=0;b>g;g++){var h=1;e+=U,(g===a||g===2*a||g===3*a)&&(e=c,f+=50);var i=g+1;b+Y>g+a&&parseInt((b-1)/a)!==parseInt(g/a)&&(h=3),(i===a||i===2*a||i===3*a||g===b-1)&&(h=2),Q(ea[g],e,f,h,a,g)}}function F(b){for(var c=a.playerTwoCards.length,d=10,e=480,f=(e-d)/(c>b?b:c),g=d-f,h=X,i=0;c>i;i++)g+=f,(i===b||i===2*b||i===3*b)&&(g=d,h+=50),Q("qb1fv",g,h,1,b,i)}function G(b){if(0!==R)for(var c=a.middle.length,d=10,e=480,f=(e-d)/(c>b?b:c),g=d-f,h=W,i=0;c>i;i++)g+=f,(i===b||i===2*b||i===3*b)&&(g=d,h+=50),Q("qb1fh",g,h,1,b,i)}function H(){_.update()}function I(a,b,c,d){console.log("creating"+a);var e=new createjs.Shape;e.graphics.beginFill("white").drawRect(0,0,60,80);var f=new createjs.Shape;f.graphics.beginStroke("black").drawRect(20,20,25,35);var g=new createjs.Text(a,"15px Arial'","black");g.textAlign="left",g.textBaseline="top",g.x=5,g.y=5;var h=new createjs.Text(a,"15px Arial'","black");h.textAlign="left",h.textBaseline="top",h.x=55,h.y=75,h.rotation=180;var i=new createjs.Container;i.name=a,i.x=b,i.y=c,i.addChild(e,g,h,f),i.on("click",d,a),da[a]=i,i.z=2,_.addChild(i)}function J(a,b,c,d){var e=new createjs.Shape;e.graphics.beginFill("#FA8072").drawRoundRect(0,0,150,60,10);var f=new createjs.Text(a,"bold 24px 'Shadows Into Light'","#FFFFFF");f.textAlign="center",f.textBaseline="middle",f.x=75,f.y=30;var g=new createjs.Container;g.name=a,g.x=b,g.y=c,g.addChild(e,f),g.on("click",d),da[a]=g,g.z=1,_.addChild(g)}function K(b){for(var c=e.getCard(parseInt(b)),d=0;52>d;d++)if(a.state["card"+d]===c)return d;return-1}function L(){fa=1;for(var a=0;a<ca.length;a++)N(ca[a]);H()}function M(b){return ba++,ba>4?void ba--:(u(g("MKCLAIM")),v("ops"),D(),b.y-=30,b.clicked=1,ia.push(b.name),a.middle.push(K(b.name)),void console.log(ia))}function N(a){0!==a.clicked&&(v("ops"),D(),ba--,0===ba?v(g("MKCLAIM")):u(g("MKCLAIM")),a.y+=30,a.clicked=0,O(a.name))}function O(b){for(var c=K(b),d=0;d<a.middle.length;d++)a.middle[d]===c&&a.middle.splice(d,1),ia[d]===b&&ia.splice(d,1);console.log(a.middle)}function P(a){0!==fa&&(0===a.clicked?M(a):N(a))}function Q(a,b,c,d,e,f){var g=new Image,h="imgs/cards/",i=".png",j=h+a+i;g.onload=H,g.src=j,g.height=200;var k=new createjs.Bitmap(g);k.z=-1,k.set({x:b,y:c}),k.scaleX=2,k.scaleY=2,k.name=a,k.cardType=d,k.clicked=0,k.on("click",function(){"qb1fv"!==k.name&&"qb1fh"!==k.name&&P(k)}),k.on("pressmove",function(a){"qb1fv"!==k.name&&"qb1fh"!==k.name&&(S.x=a.stageX,S.y=a.stageY,S.visible=!0,k.alpha=.2,H())}),k.on("tick",function(){if("qb1fv"!==k.name&&"qb1fh"!==k.name&&void 0!==S){if(S.visible===!1)return void(k.alpha=1);if(3===k.cardType){var a,b=f+e;b>=ea.length&&b<ea.length+Y&&(b=ea.length-1);var c=_.getChildByName(""+ea[b]);return a=void 0===c||null===c||0===c.clicked?50:20,void(k.alpha=S.y>k.y&&S.y<k.y+a&&Math.abs(k.x-S.x)<=U/2?.2:1)}k.alpha=S.y>=k.y&&Math.abs(k.x-S.x)<=U/2||2===k.cardType&&S.y>=k.y&&S.x>k.x&&Math.abs(S.x-k.x)<=140?.2:1}}),ca.push(k),_.addChild(k)}f.setWidthToHeight(.6);var R,S,T,U,V=700,W=400,X=100,Y=5,Z=!1,$=null,_=new createjs.Stage("demoCanvas"),aa=null,ba=0,ca=[],da={},ea=[],fa=1,ga=[],ha=e.STAGE,ia=[];_.enableDOMEvents(!0),createjs.Touch.enable(_),_.enableMouseOver(10),_.mouseMoveOutside=!0,a.userClickedSomething=function(a){alert("Clicked"),i(e.createMove($,aa,a))},a.declare=function(b){var c=e.getDeclareCheaterMove(a.state,a.currIndex,b);d.makeMove(c)},a.makeACheat=function(){var b=""+T;console.log(a.middle.clone());var c=[a.middle.length-a.state.middle.length,b],f=a.middle.clone();f.selfSubtract(a.state.middle);var g=e.getClaimMove(a.state,a.currIndex,c,f);d.makeMove(g)},d.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:e.isMoveOk,updateUI:h})}]);
//# sourceMappingURL=everything.min.js.map